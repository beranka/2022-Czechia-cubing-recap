Competitions, rounds and events in Czechia

select count(distinct competitionId) as competitions, count(*) as rounds, count(distinct eventId) as events from 
(select distinct concat(competitionId, eventId, roundTypeId), competitionId, eventId
from Results r
inner join Competitions c
on c.id=r.competitionId
where c.countryId='Czech republic'
and right(competitionId,4)=2022)a


Record count

select a.*, average+single as 'all records' from
(select sum(case when regionalAverageRecord is not null then 1 else 0 end) as average, sum(case when regionalSingleRecord is not null then 1 else 0 end) as single, sum(case when regionalAverageRecord='NR' then 1 else 0 end)+sum(case when regionalSingleRecord='NR' then 1 else 0 end) as NRs, sum(case when regionalAverageRecord='ER' then 1 else 0 end)+sum(case when regionalSingleRecord='ER' then 1 else 0 end) as ERs,
sum(case when regionalAverageRecord='WR' then 1 else 0 end)+sum(case when regionalSingleRecord='WR' then 1 else 0 end) as WRs
from Results where countryId='Czech republic' and right(competitionId, 4)='2022')a

NRs broken by event

Select a.*, single+average as total
from
(Select eventId, sum(single) as single, sum(average) as average
from
(Select eventId, case when regionalSingleRecord is not null then 1 else 0 end as single, case when regionalAverageRecord is not null then 1 else 0 end as average
from Results
where (regionalAverageRecord is not null or regionalSingleRecord is not null)
and countryId='Czech republic'
and right(competitionId, 4)=2022)a
group by eventId)a
order by 4 desc

People by number of competitions in Czechia in 2022

Select personId, count(distinct competitionId)
From
(Select personId, competitionId from Results r inner join Competitions c on c.id=r.competitionId where c.countryId='Czech republic' and right(competitionId,4)='2022')a
Group by personId 
Order by 2 desc

Countries Czechs competed in (+count, competitions)

Select countryId, count(distinct personId), count(distinct competitionId)
From
(Select distinct personId, c.countryId, r.competitionId from Results r inner join Competitions c on c.id=r.competitionId where r.countryId='Czech republic' and right(competitionId,4)='2022')a
Group by countryId
Order by 2 desc

Total number of competitions Czechs competed in

Select count(distinct competitionId)
from Results
where countryId='Czech republic'
and right(competitionId,4)='2022'

Solves and attempts total

Select
sum(case when value1>0 then 1 else 0 end)+
sum(case when value2>0 then 1 else 0 end)+
sum(case when value3>0 then 1 else 0 end)+
sum(case when value4>0 then 1 else 0 end)+
sum(case when value5>0 then 1 else 0 end) as solves, 
sum(case when value1!=0 and value1!=-2 then 1 else 0 end)+
sum(case when value2!=0 and value2!=-2 then 1 else 0 end)+
sum(case when value3!=0 and value3!=-2 then 1 else 0 end)+
sum(case when value4!=0 and value4!=-2 then 1 else 0 end)+
sum(case when value5!=0 and value5!=-2 then 1 else 0 end) as attempts
from Results r
where countryId='Czech republic' and right(competitionId, 4)='2022'
order by solves desc, attempts desc

Solves and attempts by event

Select
eventId,
sum(case when value1>0 then 1 else 0 end)+
sum(case when value2>0 then 1 else 0 end)+
sum(case when value3>0 then 1 else 0 end)+
sum(case when value4>0 then 1 else 0 end)+
sum(case when value5>0 then 1 else 0 end) as solves, 
sum(case when value1!=0 and value1!=-2 then 1 else 0 end)+
sum(case when value2!=0 and value2!=-2 then 1 else 0 end)+
sum(case when value3!=0 and value3!=-2 then 1 else 0 end)+
sum(case when value4!=0 and value4!=-2 then 1 else 0 end)+
sum(case when value5!=0 and value5!=-2 then 1 else 0 end) as attempts
from Results r
where countryId='Czech republic' and right(competitionId, 4)='2022'
group by eventId
order by solves desc, attempts desc

Number of Czechs that competed in 2022

select count(distinct personId) from Results where right(competitionId,4)='2022' and countryId='Czech republic'

Czechs by number of competitions they competed in 2022

Select cnt, count(personId) as people
from
(Select personId, count(distinct competitionId) as cnt
From
(Select personId, competitionId from Results r inner join Competitions c on c.id=r.competitionId where r.countryId='Czech republic' and right(competitionId,4)='2022')a
Group by personId 
Order by 2 desc)a
group by cnt

Competitions in 2022 for individual Czechs

Select personId, count(distinct competitionId) as cnt
From
(Select personId, competitionId from Results r inner join Competitions c on c.id=r.competitionId where r.countryId='Czech republic' and right(competitionId,4)='2022')a
Group by personId 
Order by 2 desc

Solves/attempts by person

Select
personId,
sum(case when value1>0 then 1 else 0 end)+
sum(case when value2>0 then 1 else 0 end)+
sum(case when value3>0 then 1 else 0 end)+
sum(case when value4>0 then 1 else 0 end)+
sum(case when value5>0 then 1 else 0 end) as solves, 
sum(case when value1!=0 and value1!=-2 then 1 else 0 end)+
sum(case when value2!=0 and value2!=-2 then 1 else 0 end)+
sum(case when value3!=0 and value3!=-2 then 1 else 0 end)+
sum(case when value4!=0 and value4!=-2 then 1 else 0 end)+
sum(case when value5!=0 and value5!=-2 then 1 else 0 end) as attempts
from Results r
where countryId='Czech republic' and right(competitionId, 4)='2022'
group by personId
order by solves desc, attempts desc

Number of people who shared comps with Czechs

Select count(distinct b.personId)
from 
(select
distinct personId, competitionId
from Results
where right(competitionId, 4)='2022'
and countryId='Czech republic'
)a 
inner join
(select
distinct personId, competitionId, countryId
from Results)b
on b.personId!=a.personId and a.competitionId=b.competitionId

How many people specific person met

Select a.personId, count(distinct b.personId)
from 
(select
distinct personId, competitionId
from Results
where right(competitionId, 4)='2022'
and countryId='Czech republic'
)a 
inner join
(select
distinct personId, competitionId, countryId
from Results)b
on b.personId!=a.personId and a.competitionId=b.competitionId
group by a.personId
order by 2 desc

NR avg improvement

select a.eventId as event, a.current as '2022', a.last_year as '<=2021', concat(improvement_absolute, " (", improvement_percent," %)") as improvement
from
(select a.*,
round((last_year-current)/100,2) as improvement_absolute,
round(100*(last_year-current)/current,2) as improvement_percent 
from
(Select eventId, min(average) as current, min(case when right(competitionId, 4)!='2022' then average end) as last_year
from Results
where countryId='Czech republic'
and regionalAverageRecord is not null
group by eventId)a)a
where current!=last_year
order by improvement_percent desc

NR single improvement

select a.eventId as event, a.current as '2022', a.last_year as '<=2021', concat(improvement_absolute, " (", improvement_percent," %)") as improvement
from
(select a.*,
round((last_year-current)/100,2) as improvement_absolute,
round(100*(last_year-current)/current,2) as improvement_percent 
from
(Select eventId, min(best) as current, min(case when right(competitionId, 4)!='2022' then best end) as last_year
from Results
where countryId='Czech republic'
and regionalSingleRecord is not null
group by eventId)a)a
where current!=last_year
order by improvement_percent desc

DNF, DNS per person

Select
personId,
sum(case when value1=-1 then 1 else 0 end)+
sum(case when value2=-1 then 1 else 0 end)+
sum(case when value3=-1 then 1 else 0 end)+
sum(case when value4=-1 then 1 else 0 end)+
sum(case when value5=-1 then 1 else 0 end) as DNF,
sum(case when value1=-2 then 1 else 0 end)+
sum(case when value2=-2 then 1 else 0 end)+
sum(case when value3=-2 then 1 else 0 end)+
sum(case when value4=-2 then 1 else 0 end)+
sum(case when value5=-2 then 1 else 0 end) as DNS
from Results 
where countryId='Czech republic'
and right(competitionId, 4)='2022'
group by personId
order by 2 desc

DNF, DNS total

Select
sum(case when value1=-1 then 1 else 0 end)+
sum(case when value2=-1 then 1 else 0 end)+
sum(case when value3=-1 then 1 else 0 end)+
sum(case when value4=-1 then 1 else 0 end)+
sum(case when value5=-1 then 1 else 0 end) as DNF,
sum(case when value1=-2 then 1 else 0 end)+
sum(case when value2=-2 then 1 else 0 end)+
sum(case when value3=-2 then 1 else 0 end)+
sum(case when value4=-2 then 1 else 0 end)+
sum(case when value5=-2 then 1 else 0 end) as DNS
from Results 
where countryId='Czech republic'
and right(competitionId, 4)='2022'

People without DNF/DNS

select count(case when DNF+DNS=0 then 1 end) from 
(Select
personId,
sum(case when value1=-1 then 1 else 0 end)+
sum(case when value2=-1 then 1 else 0 end)+
sum(case when value3=-1 then 1 else 0 end)+
sum(case when value4=-1 then 1 else 0 end)+
sum(case when value5=-1 then 1 else 0 end) as DNF,
sum(case when value1=-2 then 1 else 0 end)+
sum(case when value2=-2 then 1 else 0 end)+
sum(case when value3=-2 then 1 else 0 end)+
sum(case when value4=-2 then 1 else 0 end)+
sum(case when value5=-2 then 1 else 0 end) as DNS
from Results 
where countryId='Czech republic'
and right(competitionId, 4)='2022'
group by personId)a

Foreigners by number of Czechs met

Select a.personId, count(distinct b.personId)
from 
(select
distinct personId, competitionId
from Results
where right(competitionId, 4)='2022'
and countryId='Czech republic'
)b 
inner join
(select
distinct personId, competitionId
from Results where countryId!='Czech republic')a
on a.competitionId=b.competitionId
group by a.personId
order by 2 desc